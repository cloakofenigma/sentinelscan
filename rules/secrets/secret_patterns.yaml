# Secret Detection Patterns

metadata:
  category: Secrets
  name: Secret Detection Rules
  description: "Rules for detecting hardcoded secrets and credentials"
  version: "1.0.0"

rules:
  - id: SECRET-001
    name: AWS Access Key ID
    description: AWS Access Key ID found in code
    severity: critical
    confidence: high
    cwe: CWE-798
    owasp: A02
    tags: [secrets, aws, credentials]
    languages: [all]
    detection:
      patterns:
        - pattern: "AKIA[0-9A-Z]{16}"
    remediation:
      description: "Use AWS IAM roles or environment variables for credentials"

  - id: SECRET-002
    name: AWS Secret Access Key
    description: AWS Secret Access Key found in code
    severity: critical
    confidence: high
    cwe: CWE-798
    owasp: A02
    tags: [secrets, aws, credentials]
    languages: [all]
    detection:
      patterns:
        - pattern: "(?i)(aws)?_?secret_?access_?key[\"'\\s:=]+[A-Za-z0-9/+=]{40}"
    remediation:
      description: "Use AWS IAM roles or secrets manager for credentials"

  - id: SECRET-003
    name: GitHub Token
    description: GitHub personal access token or OAuth token
    severity: critical
    confidence: high
    cwe: CWE-798
    owasp: A02
    tags: [secrets, github, token]
    languages: [all]
    detection:
      patterns:
        - pattern: "gh[pousr]_[A-Za-z0-9_]{36,}"
        - pattern: "github_pat_[A-Za-z0-9_]{22,}"
    remediation:
      description: "Use GitHub Apps or environment variables for tokens"

  - id: SECRET-004
    name: Generic API Key
    description: Generic API key pattern detected
    severity: high
    confidence: medium
    cwe: CWE-798
    owasp: A02
    tags: [secrets, api-key]
    languages: [all]
    detection:
      patterns:
        - pattern: "(?i)(api_?key|apikey)[\"'\\s:=]+[A-Za-z0-9]{20,}"
    remediation:
      description: "Store API keys in environment variables or secret manager"

  - id: SECRET-005
    name: Private Key
    description: Private key found in code
    severity: critical
    confidence: high
    cwe: CWE-321
    owasp: A02
    tags: [secrets, private-key, cryptography]
    languages: [all]
    detection:
      patterns:
        - pattern: "-----BEGIN (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----"
        - pattern: "-----BEGIN PGP PRIVATE KEY BLOCK-----"
    remediation:
      description: "Store private keys in secure key management systems"

  - id: SECRET-006
    name: Google Cloud API Key
    description: Google Cloud API key detected
    severity: critical
    confidence: high
    cwe: CWE-798
    owasp: A02
    tags: [secrets, gcp, api-key]
    languages: [all]
    detection:
      patterns:
        - pattern: "AIza[0-9A-Za-z_-]{35}"
    remediation:
      description: "Use GCP service accounts and IAM for authentication"

  - id: SECRET-007
    name: Slack Token
    description: Slack API token detected
    severity: high
    confidence: high
    cwe: CWE-798
    owasp: A02
    tags: [secrets, slack, token]
    languages: [all]
    detection:
      patterns:
        - pattern: "xox[baprs]-[0-9]{10,13}-[0-9]{10,13}[a-zA-Z0-9-]*"
    remediation:
      description: "Use Slack app credentials stored in secret manager"

  - id: SECRET-008
    name: Stripe API Key
    description: Stripe API key detected
    severity: critical
    confidence: high
    cwe: CWE-798
    owasp: A02
    tags: [secrets, stripe, api-key]
    languages: [all]
    detection:
      patterns:
        - pattern: "sk_live_[0-9a-zA-Z]{24,}"
        - pattern: "rk_live_[0-9a-zA-Z]{24,}"
    remediation:
      description: "Store Stripe keys in environment variables"

  - id: SECRET-009
    name: Database Connection String
    description: Database connection string with credentials
    severity: critical
    confidence: high
    cwe: CWE-798
    owasp: A02
    tags: [secrets, database, credentials]
    languages: [all]
    detection:
      patterns:
        - pattern: "(?i)(mysql|postgresql|postgres|mongodb|redis)://[^:]+:[^@]+@"
        - pattern: "(?i)jdbc:[a-z]+://[^:]+:[^@]+@"
    remediation:
      description: "Use secret manager for database credentials"

  - id: SECRET-010
    name: JWT Secret
    description: JWT secret key hardcoded
    severity: critical
    confidence: medium
    cwe: CWE-798
    owasp: A02
    tags: [secrets, jwt, cryptography]
    languages: [all]
    detection:
      patterns:
        - pattern: "(?i)(jwt_?secret|jwt_?key)[\"'\\s:=]+[A-Za-z0-9+/=]{20,}"
    remediation:
      description: "Store JWT secrets in secret manager with rotation"

  - id: SECRET-011
    name: SendGrid API Key
    description: SendGrid API key detected
    severity: high
    confidence: high
    cwe: CWE-798
    owasp: A02
    tags: [secrets, sendgrid, api-key]
    languages: [all]
    detection:
      patterns:
        - pattern: "SG\\.[A-Za-z0-9_-]{22}\\.[A-Za-z0-9_-]{43}"
    remediation:
      description: "Store SendGrid API key in environment variables"

  - id: SECRET-012
    name: Twilio API Key
    description: Twilio API credentials detected
    severity: high
    confidence: high
    cwe: CWE-798
    owasp: A02
    tags: [secrets, twilio, credentials]
    languages: [all]
    detection:
      patterns:
        - pattern: "SK[0-9a-fA-F]{32}"
        - pattern: "(?i)twilio.*[\"'][0-9a-fA-F]{32}[\"']"
    remediation:
      description: "Use environment variables for Twilio credentials"

  - id: SECRET-013
    name: Mailgun API Key
    description: Mailgun API key detected
    severity: high
    confidence: high
    cwe: CWE-798
    owasp: A02
    tags: [secrets, mailgun, api-key]
    languages: [all]
    detection:
      patterns:
        - pattern: "key-[0-9a-zA-Z]{32}"
    remediation:
      description: "Store Mailgun API key in secret manager"

  - id: SECRET-014
    name: Firebase API Key
    description: Firebase API key detected
    severity: high
    confidence: medium
    cwe: CWE-798
    owasp: A02
    tags: [secrets, firebase, api-key]
    languages: [all]
    detection:
      patterns:
        - pattern: "(?i)firebase.*[\"'][A-Za-z0-9_-]{39}[\"']"
    remediation:
      description: "Restrict Firebase API key usage in console"

  - id: SECRET-015
    name: Heroku API Key
    description: Heroku API key detected
    severity: high
    confidence: high
    cwe: CWE-798
    owasp: A02
    tags: [secrets, heroku, api-key]
    languages: [all]
    detection:
      patterns:
        - pattern: "(?i)heroku.*[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}"
    remediation:
      description: "Use Heroku CLI login instead of API keys"

  - id: SECRET-016
    name: Generic Password Assignment
    description: Password assigned in code
    severity: high
    confidence: medium
    cwe: CWE-798
    owasp: A02
    tags: [secrets, password, credentials]
    languages: [all]
    detection:
      patterns:
        - pattern: "(?i)(password|passwd|pwd)\\s*[=:]\\s*[\"'][^\"']{4,}[\"']"
    remediation:
      description: "Use environment variables or secret manager for passwords"

  - id: SECRET-017
    name: Azure Storage Key
    description: Azure Storage account key detected
    severity: critical
    confidence: high
    cwe: CWE-798
    owasp: A02
    tags: [secrets, azure, storage]
    languages: [all]
    detection:
      patterns:
        - pattern: "AccountKey=[A-Za-z0-9+/=]{86,88}"
    remediation:
      description: "Use Azure managed identities for storage access"

  - id: SECRET-018
    name: NPM Token
    description: NPM authentication token detected
    severity: high
    confidence: high
    cwe: CWE-798
    owasp: A02
    tags: [secrets, npm, token]
    languages: [all]
    detection:
      patterns:
        - pattern: "//registry\\.npmjs\\.org/:_authToken=[A-Za-z0-9-]+"
        - pattern: "npm_[A-Za-z0-9]{36}"
    remediation:
      description: "Use npm login and store token securely"
